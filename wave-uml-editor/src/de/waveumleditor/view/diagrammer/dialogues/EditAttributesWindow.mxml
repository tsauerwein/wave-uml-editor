<?xml version="1.0" encoding="utf-8"?>
<EditAttributes xmlns="de.waveumleditor.view.diagrammer.dialogues.*" xmlns:mx="http://www.adobe.com/2006/mxml">
	
	<mx:Script>
        <![CDATA[
        	import mx.messaging.management.Attribute;
        	import de.waveumleditor.model.classDiagram.EVisibility;
        	import de.waveumleditor.model.Identifier;
        	import de.waveumleditor.model.classDiagram.Type;
        	import de.waveumleditor.model.classDiagram.ClassAttribute;
        	import de.waveumleditor.model.classDiagram.Variable;
        	import mx.controls.Button;
        	import mx.managers.SystemManager;
        	import mx.core.Application;
        	import mx.managers.PopUpManagerChildList;
        	import adobe.utils.CustomActions;
            import mx.events.CloseEvent;
            import mx.managers.PopUpManager;
            import mx.collections.IList;
            import mx.containers.TitleWindow;
            
            import de.waveumleditor.model.classDiagram.ClassDiagramNode;
            import de.waveumleditor.model.classDiagram.UMLClass;
            import de.waveumleditor.view.diagrammer.classDiagram.Formatter;
            import de.waveumleditor.model.classDiagram.IClassElement;

            public static function editAttributeHandler(event:MouseEvent):void
            {
                var buttonClicked:Button = event.currentTarget as Button;
                trace("edit attribute handler:" + buttonClicked.id);
                
                //MockupAttribut
				var customVariable:Variable = new Variable("myCustomVariable", (new Type("myCustomType")));
				var customAttribute:ClassAttribute = new ClassAttribute(new Identifier("attr_custom"), customVariable, EVisibility.PUBLIC);
                
                var editSingleAttribute:EditSingleAttributeWindow = new EditSingleAttributeWindow();
                editSingleAttribute.update(customAttribute);//TODO Attribut über Id holen
                editSingleAttribute.popUp();
                
            }
            
            private function deleteClassElementHandler(event:MouseEvent):void
            {
            	var buttonClicked:Button = event.currentTarget as Button;
                trace("delete class element handler" + buttonClicked.id);
            }
            
            private function newAttributeHandler(event:Event):void
            {
            	var defaultVariable:Variable = new Variable("", Type.STRING);
            	var newAttribute:ClassAttribute = new ClassAttribute(new Identifier("default_attr"), defaultVariable, EVisibility.PUBLIC, false);
                
                var editSingleAttribute:EditSingleAttributeWindow = new EditSingleAttributeWindow();
                editSingleAttribute.update(newAttribute);//TODO Attribut über Id holen
                editSingleAttribute.popUp();
            }
            
            private function titleWindow_close(evt:CloseEvent):void {
                PopUpManager.removePopUp(titleWindow);
            }
            public function update(nodeData:ClassDiagramNode):void 
			{
				if (!(nodeData is UMLClass)) throw new Error("nodeData must be an instance of UMLCLass");
				
				var classData:UMLClass = nodeData as UMLClass;
				
				
				// update class-name
				Formatter.formatLabelOfClassElement(classData, classNodeName);
				var nodeName:String;
				nodeName = nodeData.getName();
				if(nodeName==""){nodeName="Neue Klasse"};//default
				classNodeName.text = nodeName;
				
				// add attributes
				var attributes:IList = classData.getAttributes();
				addElementsToContentGrid(attributes, attributesList);
			}
			
			public function addElementsToContentGrid(elements:IList, classDataGrid:Grid):void 
			{
				if(elements.length > 0)
				{
					for(var i:int = 0; i < elements.length; i++)
					{
						var classElement:Object = elements.getItemAt(i);
						attributesList.addChild(new EditClassNodeElement(classElement as ClassAttribute));
					}
				}
			}
			public function popUp():void
			{	
		        titleWindow.title = "Attribute editieren";
		        titleWindow.addChild(editAttributesGrid);
		        
		        mx.managers.PopUpManager.addPopUp(titleWindow, SystemManager.getSWFRoot(titleWindow), true);
		        mx.managers.PopUpManager.centerPopUp(titleWindow);
			}
        ]]>
    </mx:Script>
<!--	<container> -->
	<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" 
			id="titleWindow"
			layout="vertical" 
			minWidth="340" 
			minHeight="300"
	        title="Attribute editieren"
	        titleStyleName="titleText"
	        backgroundColor="#FFFFFF"
	        backgroundAlpha="0.7"
	        borderAlpha="1.0"
	        cornerRadius="10"
	        dropShadowEnabled="true"
	        showCloseButton="true"
	        close="titleWindow_close(event)" borderColor="#E2E2E2"> 
	    
	    <mx:Grid id="editAttributesGrid" width="100%" height="100%" verticalAlign="top">
	        <mx:GridRow width="100%" height="100%">
	            <mx:GridItem width="100%" height="100%">
	                <mx:Grid width="100%" height="100%">
	                    <mx:GridRow width="100%" height="15">
	                        <mx:GridItem width="100%" height="100%" >
	                            <mx:Label id="classNodeName">
	                        		<mx:text>
	                        		
	                        		</mx:text>
	                            </mx:Label>
	                        </mx:GridItem>
	                    </mx:GridRow>
	                    <mx:GridRow width="100%" height="5">
	                        <mx:GridItem width="100%" height="0%" >
	                       		<mx:HRule x="0" width="100%" shadowColor="#418D8E" strokeColor="#418D8E"/>
	                        </mx:GridItem>
	                    </mx:GridRow>
	                    <mx:GridRow width="100%">
	                        <mx:GridItem width="100%" height="100%">
	                            <mx:Grid width="100%" id="attributesList">
	                            </mx:Grid>
	                        </mx:GridItem>
	                    </mx:GridRow>
	                    <mx:GridRow width="100%">
	                   		<mx:GridItem horizontalAlign="right">
	                   			<mx:Button label="+" height="15" width="35" click="newAttributeHandler(event)"/>
	                    	</mx:GridItem>
	                    	<mx:GridItem>
	                    	</mx:GridItem>
	                    </mx:GridRow>
	                </mx:Grid>
	            </mx:GridItem>
	        </mx:GridRow>
	    
	    	<mx:GridRow width="100%" height="0%">
	    		<mx:GridItem>
				    <mx:Grid width="100%" height="0%">
				        <mx:GridRow width="100%" height="100%">
				            <mx:GridItem width="100%" height="100%">
				            </mx:GridItem>
				            <mx:GridItem width="0%" height="100%">
				                <mx:Button label="schließen" click="titleWindow_close(CloseEvent.CLOSE as CloseEvent)"/>
				            </mx:GridItem>
				        </mx:GridRow>
				    </mx:Grid>
			   </mx:GridItem>
		    </mx:GridRow>
	    </mx:Grid>
		
	
	
	</mx:TitleWindow> 
<!--	</container>-->
</EditAttributes>