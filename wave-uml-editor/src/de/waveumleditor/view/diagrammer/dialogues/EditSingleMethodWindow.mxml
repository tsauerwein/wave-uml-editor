<?xml version="1.0" encoding="utf-8"?>
<EditSingleMethod xmlns="de.waveumleditor.view.diagrammer.dialogues.*" xmlns:mx="http://www.adobe.com/2006/mxml">
		<mx:Script>
        <![CDATA[
        	import de.waveumleditor.model.classDiagram.Type;
        	import de.waveumleditor.view.diagrammer.events.NodeMethodEvent;
        	import de.waveumleditor.model.Identifier;
			import de.waveumleditor.model.classDiagram.ClassConstructorMethod;
			import de.waveumleditor.model.classDiagram.ClassMethod;
			import de.waveumleditor.model.classDiagram.EVisibility;
			
			import mx.collections.ArrayCollection;
			import mx.containers.TitleWindow;
			import mx.controls.Button;
			import mx.events.CloseEvent;
			import mx.managers.PopUpManager;
			import mx.managers.SystemManager;
			
			//visibility Combo-Box Data provider
			[Bindable]
            public var visibility:ArrayCollection = new ArrayCollection(
                [ {label:"public", data:EVisibility.PUBLIC}, 
                  {label:"private", data:EVisibility.PRIVATE}, 
                  {label:"protected", data:EVisibility.PROTECTED},
                  {label:"package", data:EVisibility.PACKAGE} ]);
			
			//types Combo-Box Data provider
			[Bindable]
            public var type:Array = new Array(
                  "String", 
                  "boolean", 
                  "int",
                  "double" );
			//Attribut key
			private var methodKey:String;
			    

            
            private function close(evt:CloseEvent):void {
                PopUpManager.removePopUp(singleMethodWindow);
            }
            public function update(method:ClassConstructorMethod):void 
			{
				trace("update method " + method.getIdentifier().getId());
				
				
				//Sichtbarkeit
				cbVisibility.selectedIndex = method.getVisibility().getValue();
				//key
				methodKey = method.getIdentifier().getId();
				
				if (method is ClassMethod)
				{
					var classMethod:ClassMethod =  new ClassMethod(method.getIdentifier(), 
																	(method as ClassMethod).getName(),
																	(method as ClassMethod).getVisibility(), 
																	(method as ClassMethod).getReturnType(), 
																	(method as ClassMethod).isAbstract(),
																	(method as ClassMethod).isStatic());
					
					//Static
					chbStatic.selected = classMethod.isStatic();
					//Abstrakt
					chbAbstract.selected = classMethod.isAbstract();
					//Typ
					var current_type:String = classMethod.getReturnType().getName();
					if(type.indexOf(current_type)<0)
					{
						type.push(current_type);
					}
					cbType.selectedItem = current_type;
					//Name
					txtMethodName.text = classMethod.getName();
	
				}
				// ClassConstructorMethod
				else
				{
					gdInput.removeChild(grStatic);
					gdInput.removeChild(grAbstract);
					gdInput.removeChild(grType);
					
					/* txtMethodName.text = this.getClassData().getName();
					txtMethodName.enabled = false;
					grStatic.percentHeight = 0;
					chbStatic.enabled = false;
					chbStatic.visible = false;
					lblStatic.visible = false;
					grAbstract.percentHeight = 0;
					chbAbstract.enabled = false;
					chbAbstract.visible = false;
					lblAbstract.visible = false;
					grType.percentHeight = 0;
					cbType.enabled = false;
					cbType.visible = false;
					lblType.visible = false; */
				}
				
			}
			
			public function saveMethod(event:Event):void 
			{
				trace("save method event");
				
				var nodeMethodEvent:NodeMethodEvent;
				
				if(isConstructor)
				{
					var newClassConstructorMethod:ClassConstructorMethod = new ClassConstructorMethod(
						new Identifier(methodKey),
						EVisibility.getEVisibilityFromVal(cbVisibility.selectedIndex)
					)
		
		            nodeMethodEvent= new NodeMethodEvent(getClassData(), newClassConstructorMethod, getEditMethodsWindow());
		            controller.handleEditMethod(nodeMethodEvent);
				}
	            else 
	            {
	            	var newType:Type;
					if(type.indexOf(cbType.selectedItem)<0)
					{
						newType = new Type(cbType.text);
					}
					else
					{
						newType = new Type(cbType.selectedItem.toString());
					}
					
	            	var newClassMethod:ClassMethod = new ClassMethod(
	            		new Identifier(methodKey), 
	            		txtMethodName.text,
	            		EVisibility.getEVisibilityFromVal(cbVisibility.selectedIndex),
	            		newType,
	            		chbAbstract.selected,
	            		chbStatic.selected);
	            		
	            	nodeMethodEvent= new NodeMethodEvent(getClassData(), newClassMethod, getEditMethodsWindow());
		            controller.handleEditMethod(nodeMethodEvent);	
	            }
	            
				PopUpManager.removePopUp(singleMethodWindow);
			}
			

			public function popUp():void
			{	
		        singleMethodWindow.title = "Methode editieren";
      
		        singleMethodWindow.addChild(editMethodGrid);
		        
		        mx.managers.PopUpManager.addPopUp(singleMethodWindow, SystemManager.getSWFRoot(singleMethodWindow), true);
		        mx.managers.PopUpManager.centerPopUp(singleMethodWindow);
			}
        ]]>
    </mx:Script>
<!--	<container> -->
	<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" 
			id="singleMethodWindow"
			layout="vertical" 
			width="280" 
			height="220"
	        title="Methode editieren"
	        titleStyleName="titleText"
	        backgroundColor="#FFFFFF"
	        backgroundAlpha="0.9"
	        borderAlpha="1.0"
	        cornerRadius="10"
	        dropShadowEnabled="true"
	        showCloseButton="true"
	        close="close(event)" borderColor="#E2E2E2"> 
	    
	    <mx:Grid id="editMethodGrid" width="100%" height="100%" verticalAlign="top">
	        <mx:GridRow width="100%" height="100%">
	            <mx:GridItem width="100%" height="100%">
                    <mx:Grid id="gdInput">
                        <mx:GridRow id="grVisibility" width="100%" height="100%">
                            <mx:GridItem width="100%" height="100%">
                            	<mx:Label id="lblVisibility" text="Sichtbarkeit:"/>
                            </mx:GridItem>
                            <mx:GridItem width="100%" height="100%" horizontalAlign="right">
                            	<mx:ComboBox id="cbVisibility" dataProvider="{visibility}"/>
                            </mx:GridItem>
                        </mx:GridRow>
                        <mx:GridRow id="grStatic" width="100%" height="100%">
                            <mx:GridItem width="100%" height="100%">
                            	<mx:Label id="lblStatic" text="Statisch:"/>
                            </mx:GridItem>   
                            <mx:GridItem width="100%" height="100%" horizontalAlign="right">
                            	<mx:CheckBox id="chbStatic" label=""/>
                            </mx:GridItem>    
                        </mx:GridRow>
                        <mx:GridRow id="grAbstract" width="100%" height="100%">
                            <mx:GridItem width="100%" height="100%">
                            	<mx:Label id="lblAbstract" text="Abstrakt:"/>
                            </mx:GridItem>   
                            <mx:GridItem width="100%" height="100%" horizontalAlign="right">
                            	<mx:CheckBox id="chbAbstract" label=""/>
                            </mx:GridItem>    
                        </mx:GridRow>
                        <mx:GridRow id="grType" width="100%" height="100%">
                            <mx:GridItem width="100%" height="100%">
                            	<mx:Label id="lblType" text="RÃ¼ckgabetyp:"/>
                            </mx:GridItem>
                            <mx:GridItem  width="100%" height="100%" horizontalAlign="right">
                            	<mx:ComboBox id="cbType" editable="true" dataProvider="{type}"/>
                            </mx:GridItem>
                        </mx:GridRow>
                        <mx:GridRow width="100%" height="100%">
                            <mx:GridItem width="100%" height="100%">
                            	<mx:Label text="Name:"/>
                            </mx:GridItem>
                            <mx:GridItem width="100%" height="100%" horizontalAlign="right">
                            	<mx:TextInput id="txtMethodName" text="" maxChars="20" width="130"/>
                            </mx:GridItem>
                        </mx:GridRow>
                    </mx:Grid>
	            </mx:GridItem>
	        </mx:GridRow>
	    
	    	<mx:GridRow width="100%" height="0%">
	    		<mx:GridItem>
				    <mx:Grid width="100%" height="0%">
				        <mx:GridRow width="100%" height="100%">
				            <mx:GridItem width="100%" height="100%">
				            </mx:GridItem>
				            
				            <mx:GridItem width="0%" height="100%">
				                <mx:Button label="Speichern" click="saveMethod(event)"/>
				            </mx:GridItem>
				            <mx:GridItem width="0%" height="100%">
				                <mx:Button label="Abbrechen" click="close(CloseEvent.CLOSE as CloseEvent)"/>
				            </mx:GridItem>
				        </mx:GridRow>
				    </mx:Grid>
			   </mx:GridItem>
		    </mx:GridRow>
	    </mx:Grid>
		
	
	
	</mx:TitleWindow> 
</EditSingleMethod>
